{% extends "base.html" %}

{% block title %}Quick Log{% endblock %}

{% block content %}
<div class="log-page">
    <h1 class="page-title">Quick Log Entry</h1>
    <p class="page-subtitle">Track your glucose, meal, and mood in seconds</p>

    <form method="POST" class="log-form" id="logForm">
        <!-- Blood Glucose Input -->
        <div class="form-group">
            <label for="glucose_level" class="form-label">
                Blood Glucose (mmol/L) <span class="required">*</span>
            </label>
            <input
                type="number"
                id="glucose_level"
                name="glucose_level"
                class="form-input"
                placeholder="e.g., 6.5"
                min="2.0"
                max="30.0"
                step="0.1"
                required
            >
            <small class="form-help">Normal range: 3.9-10.0 mmol/L</small>
        </div>

        <!-- Meal Type Selection -->
        <div class="form-group">
            <label class="form-label">
                Meal Type <span class="required">*</span>
            </label>
            <div class="button-grid">
                <button type="button" class="btn-option" data-value="breakfast" onclick="selectOption(this, 'meal_type')">
                    üåÖ Breakfast
                </button>
                <button type="button" class="btn-option" data-value="lunch" onclick="selectOption(this, 'meal_type')">
                    ‚òÄÔ∏è Lunch
                </button>
                <button type="button" class="btn-option" data-value="dinner" onclick="selectOption(this, 'meal_type')">
                    üåô Dinner
                </button>
                <button type="button" class="btn-option" data-value="snack" onclick="selectOption(this, 'meal_type')">
                    üçé Snack
                </button>
                <button type="button" class="btn-option" data-value="none" onclick="selectOption(this, 'meal_type')">
                    ‚è≠Ô∏è No Meal
                </button>
            </div>
            <input type="hidden" id="meal_type" name="meal_type" required>
        </div>

        <!-- Mood Selection -->
        <div class="form-group">
            <label class="form-label">
                How are you feeling? <span class="required">*</span>
            </label>
            <div class="button-grid">
                <button type="button" class="btn-option" data-value="happy" onclick="selectOption(this, 'mood')">
                    üòä Happy
                </button>
                <button type="button" class="btn-option" data-value="calm" onclick="selectOption(this, 'mood')">
                    üòå Calm
                </button>
                <button type="button" class="btn-option" data-value="stressed" onclick="selectOption(this, 'mood')">
                    üò∞ Stressed
                </button>
                <button type="button" class="btn-option" data-value="tired" onclick="selectOption(this, 'mood')">
                    üò¥ Tired
                </button>
                <button type="button" class="btn-option" data-value="frustrated" onclick="selectOption(this, 'mood')">
                    üò§ Frustrated
                </button>
            </div>
            <input type="hidden" id="mood" name="mood" required>
        </div>

        <!-- Optional Notes -->
        <div class="form-group">
            <label for="notes" class="form-label">
                Notes (Optional)
            </label>
            <textarea
                id="notes"
                name="notes"
                class="form-textarea"
                placeholder="Any thoughts or observations?"
                rows="3"
            ></textarea>
        </div>

        <!-- Submit Button -->
        <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-large">
                ‚úÖ Save Entry
            </button>
            <a href="{{ url_for('index') }}" class="btn btn-secondary">
                Cancel
            </a>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    /**
     * Handle option button selection
     * Provides visual feedback and updates hidden input
     */
    function selectOption(button, inputId) {
        // Get all buttons in the same group
        const buttons = button.parentElement.querySelectorAll('.btn-option');

        // Remove active class from all buttons
        buttons.forEach(btn => btn.classList.remove('active'));

        // Add active class to clicked button
        button.classList.add('active');

        // Update hidden input value
        const value = button.getAttribute('data-value');
        document.getElementById(inputId).value = value;

        console.log(`Selected ${inputId}: ${value}`); // For debugging
    }

    /**
     * Form validation before submit
     */
    document.getElementById('logForm').addEventListener('submit', function(e) {
        const glucoseLevel = document.getElementById('glucose_level').value;
        const mealType = document.getElementById('meal_type').value;
        const mood = document.getElementById('mood').value;

        console.log('Form submission attempt:');
        console.log('Glucose:', glucoseLevel);
        console.log('Meal Type:', mealType);
        console.log('Mood:', mood);

        // Validate all required fields are filled
        if (!glucoseLevel) {
            e.preventDefault();
            alert('Please enter your blood glucose level.');
            return false;
        }

        if (!mealType) {
            e.preventDefault();
            alert('Please select a meal type.');
            // Highlight the meal type section
            document.querySelector('[data-value="breakfast"]').parentElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            return false;
        }

        if (!mood) {
            e.preventDefault();
            alert('Please select how you\'re feeling.');
            // Highlight the mood section
            document.querySelector('[data-value="happy"]').parentElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            return false;
        }

        // Validate glucose range
        const glucose = parseFloat(glucoseLevel);
        if (glucose < 2.0 || glucose > 30.0) {
            e.preventDefault();
            alert('Glucose level must be between 2.0 and 30.0 mmol/L.');
            return false;
        }

        // All validation passed
        console.log('Form validation passed, submitting...');
        return true;
    });

    // Optional: Show which fields are required on page load
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Quick Log form loaded');
        console.log('Required fields: glucose_level, meal_type, mood');
    });
</script>
{% endblock %}